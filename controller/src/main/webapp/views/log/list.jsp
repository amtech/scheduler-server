<%@ page language="java" contentType="text/html; charset=utf-8"	pageEncoding="utf-8"%><html><head><%@ include file="/WEB-INF/layouts/base.jsp"%><link type="text/css"	href="${ctx }/global/bootstrap-datetimepicker/bootstrap-datetimepicker.min.css"	rel="stylesheet" /></head><div class="row">	<div class="col-md-12">		<table class="table">			<tr>				<td>					<div>						<h5 style="float: left;">所属应用</h5>						<select id="appselect" style="float: left;"							class=" btn btn-default">							<option value="">请选择</option>						</select>					</div>				</td>				<td>					<div>						<h5 style="float: left;">所属任务</h5>						<select id="jobselect" class=" btn btn-default">							<option value="">请选择</option>						</select>					</div>				</td>				<td>					<div>						<h5 style="float: left;">所属计划</h5>						<select id="triggerselect" class=" btn btn-default">							<option value="">请选择</option>						</select>					</div>				</td>				<td>					<div>						<h5 style="float: left;">状态</h5>						<select id="statusselect" class=" btn btn-default">							<option value="">状态列表</option>							<option value="0">异常</option>							<option value="1">正常</option>						</select>					</div>				</td>			</tr>			<tr>                <td>                    <div id="starttime_main" class="control-group">                        <h5 style="float: left;">开始时间从</h5>                        <div id="starttime"                             class="input-group date form_datetime col-md-5">                            <input id="beginTimeVal" class="btn btn-default" size="16" type="text" value=""                                   readonly> </input> <span class="input-group-addon"> <span                                class="glyphicon glyphicon-th"></span>							</span>                        </div>                    </div>                </td>                <td>                    <div id="endtime_main" class="control-group">                        <h5 style="float: left;">到</h5>                        <div id="endtime" class="input-group date form_datetime col-md-5"                             data-date-format="dd MM yyyy - HH:ii p"                             data-link-field="dtp_input1">                            <input id="endTimeVal" class="btn btn-default" size="16" type="text" value=""                                   readonly>                            <span class="input-group-addon"><span class="glyphicon glyphicon-th"></span></span>                        </div>                    </div>                </td>				<td><button class="btn btn-default" type="button"						onclick="query();">查询</button>                </td>				<td>	<a class="btn btn-default" href="javascript:exportExcel();"    type="button">导出Excel</a></td>			</tr>		</table>		<div class="portlet box grey">			<div class="portlet-title">				<div class="caption">					<div class="theme-options" style="display: block;">						<span style="float: left;">日志列表 </span>					</div>				</div>			</div>			<div class="portlet-body">				<div class="table-responsive" id="table">					<table class="table table-bordered table-striped">						<thead>							<tr>								<th class="col-md-1">应用名</th>								<th>任务名</th>								<th>计划名</th>								<th>开始时间</th>								<th>结束时间</th>								<th>耗时</th>								<th>状态</th>								<th>异常信息</th>							</tr>						</thead>						<tbody >						</tbody>					</table>				</div>			</div>		</div>	</div></div><input id="logQueryCondition"  value="" type="hidden"/><script type="text/javascript"	src="${ctx }/global/bootstrap-datetimepicker/bootstrap-datetimepicker.min.js"></script><script type="text/javascript"	src="${ctx }/global/bootstrap-datetimepicker/bootstrap-datetimepicker.zh-CN.js"></script><script type="text/javascript">	$(function() {		$('#starttime').datetimepicker({			language : 'zh-CN',			format : 'yyyy-MM-dd hh:ii:ss',			weekStart : 1,			todayBtn : 1,			autoclose : 1,			todayHighlight : 1,			startView : 2,			forceParse : 0,			minuteStep : 1,			showMeridian : 1,			pickerPosition : "bottom-left"		});		$('#endtime').datetimepicker({			language : 'zh-CN',			format : 'yyyy-MM-dd hh:ii:ss',			weekStart : 1,			todayBtn : 1,			autoclose : 1,			todayHighlight : 1,			startView : 2,			forceParse : 0,			minuteStep : 1,			showMeridian : 1,			pickerPosition : "bottom-left"		})		loadAppOption();	})	function loadAppOption() {		var opt = "";		$.ajax({			url : "${ctx}/log/loadAppOption",			type : "get",			success : function(data) {				$.each(data, function(i, item) {					opt = opt + "<option value=\"" + item.id							+ "\"onclick=\"selectApp(\'"+item.id+"\');\">"							+ item.name + "</option>";				});				$("#appselect").append(opt);			},			error : function() {				alert("获取应用列表失败！！");			}		});	}	function selectApp(appId) {		var opt = "<option value=''>任务列表</option>";		$.ajax({			url : "${ctx}/log/loadJobOption/" + appId,			type : "get",			success : function(data) {				if (data.length > 0) {					$.each(data, function(i, item) {												opt = opt + "<option value=\"" + item.id								+ "\" onclick=\"selectJob(\'" + appId + "\',\'"								+ item.id + "\');\">" + item.name + "</option>";					});					$("#jobselect").html("");					$("#jobselect").append(opt);				} else {					alert("该应用暂无任务");				}			},			error : function() {				alert("获取应用列表失败！！");			}		});	}	function selectJob(appId, jobId) {		var opt = "<option value=''>计划列表</option>";		$.ajax({			url : "${ctx}/log/loadTriggerOption/" + appId + "/" + jobId,			type : "get",			success : function(data) {				if (data.length > 0) {					$.each(data, function(i, item) {						opt = opt + "<option value=\"" + item.id								+ "\" >"								+ item.name + "</option>";					});					$("#triggerselect").html("");					$("#triggerselect").append(opt);				} else {					alert("该任务暂无计划");				}			},			error : function() {				alert("获取应用列表失败！！");			}		});	}	function query() {		$.ajax({			url : "${ctx}/log/list/",			type : "post",			data:{				appId:$("#appselect").val(),				jobId:$("#jobselect").val(),				triggerId:$("#triggerselect").val(),				status:$("#statusselect").val(),				beginTime:$("#beginTimeVal").val(),				endTime:$("#endTimeVal").val()			},			success : function(data) {				$("#table").html("");			 	$("#table").html(data);			},			error : function() {				alert("加载数据失败！！");			}		});	}	function exportExcel(){		var logQueryCondition=$("#logQueryCondition").val();		if(logQueryCondition==""){//没有做过查询			$.ajax({				url : "${ctx}/log/exportExcel",				type : "post",				data:{					appId:$("#appselect").val(),					jobId:$("#jobselect").val(),					triggerId:$("#triggerselect").val(),					status:$("#statusselect").val(),					beginTime:$("#beginTimeVal").val(),					endTime:$("#endTimeVal").val()				},				success : function(data) {					$("#logQueryCondition").val(data);					location.href="${ctx}/log/exportExcel/"+data;				},				error : function() {					alert("文件导出失败！！");				}			});		}else{//做过查询			location.href="${ctx}/log/exportExcel/"+logQueryCondition;		}		 	}</script></html>